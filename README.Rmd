---
title: netvis
output:
  github_document:
    number_sections: yes
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  warning = FALSE,
  message = FALSE
)
library(tidyverse)
library(tmap)
tmap_mode("view")
```

<!-- badges: start -->
<!-- badges: end -->

The goal of this repo is to demonstrate different visualisation techniques for communicating information about transport networks.

```{r, eval = FALSE, echo=FALSE}
# install.packages("devtools")
devtools::install_github("ITSLeeds/netvis")
```

# Example data

We'll use a route network dataset from the Propensity to Cycle Tool (PCT) to demonstrate the package. The PCT is a web application that allows users to explore cycling potential across England and Wales. The PCT is available at [www.pct.bike](https://www.pct.bike/).

# Static data visualisation

A simple visualisation of the data in a multi-panel static map is shown below.

```{r, echo=FALSE}
rnet_leeds = pct::get_pct_rnet("west-yorkshire")
rnet_leeds = rnet_leeds |>
  select(-1)
zones_leeds = zonebuilder::zb_zone("Leeds")
central_leeds = zones_leeds |>
  dplyr::filter(circle_id == 1) |>
  sf::st_union()
rnet_central = sf::st_intersection(rnet_leeds, central_leeds)
plot(rnet_central)
# sf::st_write(rnet_central, "test-data/rnet_central.geojson", delete_dsn = TRUE)
```

# Interactive data visualisation with line widths

The `tmap` package provides a simple way to create interactive maps. The code below shows how to create an interactive map of the route network data.

```{r, echo=FALSE}
m1 =
  tm_shape(rnet_central) +
  tm_lines(
    lwd = "bicycle",
    scale = 9
  )
tmap_save(m1, "maps/m1.html")
# browseURL("maps/m1.html")
webshot2::webshot("maps/m1.html")
width_multiplier = round(max(rnet_central$dutch_slc) / max(rnet_central$bicycle))
```

The maximum level of flow in the Go Dutch scenario is `r round(width_multiplier)` times the maximum level of flow in the baseline scenario. We can use this to scale the line widths as illustrated below.

```{r, echo=FALSE, out.width="50%", fig.show="hold"}
m2 = tm_shape(rnet_central) +
  tm_lines(
    lwd = "dutch_slc",
    scale = 9 * width_multiplier
  )
tmap_save(m2, "maps/m2.html")
# browseURL("maps/m2.html")
webshot2::webshot("maps/m1.html")
webshot2::webshot("maps/m2.html")
```